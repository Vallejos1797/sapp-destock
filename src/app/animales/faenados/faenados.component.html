<div class="container card-body mt-4">
  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h4>Fecha de F:  {{ getFormattedDate() }}</h4>
  </div>
  <div *ngIf="loadingEspecies " class="full-screen-spinner">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>
  <div *ngIf="!loadingEspecies ">

    <!-- Botones de especies -->
 <div class="d-flex flex-column ">
   <div class="d-flex mb-2 gap-2">
     <h4>Especies:</h4>

     <div class="btn-group" role="group" aria-label="Botones de especies">
       <button
         *ngFor="let especie of especies"
         class="btn btn-outline-primary"
         [ngClass]="{'active': selectedSpecies?.id === especie.id}"
         (click)="onEspecieChange(especie)"
       >
         {{ especie.nombre }}
       </button>
     </div>
   </div>

   <div class="d-flex mb-4 gap-2">
     <h4>Ganchos:</h4>

     <div class="btn-group" role="group" aria-label="Botones de especies">
       <button
         *ngFor="let gancho of ganchos"
         class="btn btn-outline-primary"
         [ngClass]="{'active': selectedGancho?.id === gancho.id}"
         (click)="onGanchoChange(gancho)"
       >
         {{ gancho.nombre +' ('+gancho.peso+')'}}
       </button>
     </div>
   </div>
 </div>




    <!-- Tabla de animales -->
    <div *ngIf="selectedSpecies">
      <h5 class="mb-3 text-success">{{ selectedSpecies.nombre }}</h5>

      <div class="mb-1 d-flex justify-content-between align-items-start gap-2">
        <div class="d-flex gap-2 w-50">
          <input type="text"
                 class="form-control "
                 (change)="changeSearch($event)"
                 [(ngModel)]="this.filter.code"
                 placeholder="Buscar por SubCód+Cód. Destinatario">
          <button  class="btn btn-secondary" (click)="getAnimals()">BUSCAR</button>

        </div>
        <nav>
          <ul class="pagination">
            <li class="page-item" [class.disabled]="table.current_page == 1">
              <a class="page-link" (click)="changePage(table.current_page - 1)">Anterior</a>
            </li>
            <li *ngFor="let page of [].constructor(totalPages); let i = index" class="page-item" [class.active]="table.current_page == (i + 1)">
              <a class="page-link" (click)="changePage(+i + 1)"> {{ i + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="table.current_page == totalPages">
              <a class="page-link" (click)="changePage(+table.current_page + 1)">Siguiente</a>
            </li>
          </ul>
        </nav>
      </div>

      <table  class="table table-striped">
        <thead>
        <tr>
          <th>SubCód+Cód. Destinatario</th>
          <th>Etapa productiva</th>
          <th>Peso</th>
          <th>Opción</th>
        </tr>
        </thead>
        <tbody  *ngIf="this.table.data.length==0 && !loadingAnimales">
        <tr>
          <td>    No se encontraron registros</td>
          <td>    </td>
          <td>    </td>
          <td>    </td>

        </tr>
        </tbody>
        <tbody  *ngIf="this.table.data.length==0 && loadingAnimales">
        <tr>
          <td>    Cargando registros...</td>
          <td>    </td>
          <td>    </td>
          <td>    </td>

        </tr>
        </tbody>
        <tbody *ngIf="this.table.data.length>0">
        <tr *ngFor="let animal of this.table.data"
            [ngClass]="{
          'fila-con-peso': animal.peso_faenado >0,
          'fila-normal': animal.peso_faenado<=0,
          'fila-transparente': true
        }">

          <td>{{ animal.SubCod + ' - ' + animal?.ingreso?.destinatario?.codigo }}</td>
          <td>
            <span>
              {{ animal.tipo_acabado + ' ' + animal?.etapa_productiva + ' / ' + animal.genero }}
            </span>
            <br>
            <samp>
              {{' COD: ' + animal.codigo_agrocalidad }}
            </samp>
          </td>
          <td>
            {{ animal?.peso_faenado>0 ? animal?.peso_faenado:'0.00' }} lb
          </td>
          <td>
            <button *ngIf="!animal?.loading " class="btn  btn-guardar me-2" (click)="guardar(animal)">GUARDAR</button>
            <button *ngIf="animal?.loading" class="btn  btn-guardando">Cargando...</button>
            <button *ngIf="!animal?.loading && animal?.peso_faenado>0" class="btn btn-imprimir" (click)="imprimir(animal)">IMPRIMIR</button>
          </td>
        </tr>
        </tbody>
      </table>

    </div>
  </div>
</div>

